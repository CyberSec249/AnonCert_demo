import { Modal, Input, message } from 'ant-design-vue'
import { createVNode, ref } from 'vue'

// â€”â€” æ’¤é”€è¯ä¹¦
async function handleRevoke(record: CertItem) {
  const inputValue = ref('') // ç»‘å®šå”¯ä¸€è§£è¾“å…¥æ¡†

  Modal.confirm({
    title: 'ç¡®è®¤æ’¤é”€',
    content: () =>
      createVNode('div', {}, [
        createVNode('p', null, `ç¡®å®šè¦æ’¤é”€è¯ä¹¦ (ID=${record.id}) å—ï¼Ÿ`),
        createVNode(Input, {
          style: 'margin-top:8px;',
          placeholder: 'è¯·è¾“å…¥å”¯ä¸€è§£ X',
          type: 'password',            // ğŸ‘ˆ å¯†æ–‡æ˜¾ç¤ºæ›´å®‰å…¨
          onInput: (e: any) => {
            inputValue.value = e.target.value
          }
        })
      ]),
    okText: 'ç¡®è®¤',
    cancelText: 'å–æ¶ˆ',
    async onOk() {
      if (!inputValue.value) {
        message.warning('è¯·è¾“å…¥å”¯ä¸€è§£ X')
        return Promise.reject() // é˜»æ­¢å…³é—­å¼¹çª—
      }
      try {
        const res = await fetch('/api/revoke/cert', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            id: record.id,
            x: inputValue.value.trim()
          })
        })
        if (!res.ok) throw new Error(`HTTP ${res.status}`)
        const data = await res.json()
        message.success(data?.msg || 'è¯ä¹¦å·²æ’¤é”€')
        await fetchList()
      } catch (e) {
        console.error(e)
        message.error('æ’¤é”€å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
      }
    }
  })
}
